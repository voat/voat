function closeDashboardHandler(n){var t=$("div[id=dashboard]"),i;if(t!==null&&!$.contains(t[0],n.target))return t.hide(),i=$("body"),i.off("click.menu"),!1}function registerDashboardHandler(){$(".top-bar > nav > a").click(function(){var n=$("div[id=dashboard]"),t=$("body");if(n.toggle(),n.is(":visible"))t.on("click.menu",closeDashboardHandler);else t.off("click.menu");return!1})}function initiateWSConnection(){$.connection!=null&&$.connection.hub.start({transport:"webSockets"}).done(function(){})}function wireTooltips(){$(".userinfo:not(.tooltipstered)").tooltipster({content:"Loading user info...",contentAsHTML:"true",animation:"grow",functionBefore:function(n,t){t();n.data("ajax")!=="cached"&&$.ajax({type:"GET",url:"/ajaxhelpers/userinfo/"+n.attr("data-username"),success:function(t){n.tooltipster("content",t).data("ajax","cached")}})}})}function mustLogin(){$("#mustbeloggedinModal").modal()}function notEnoughCCP(){$("#notenoughccp").modal()}function notEnoughCCPUpVote(){$("#notenoughccpupvote").modal()}function firstTimeVisitorWelcome(){$("#firsttimevisitorwelcomemessage").toggle()}function voteSubmission(n,t,i){submissionVoteLock==null&&(submissionVoteLock={},t=t==-1?-1:1,i&&i.html(""),$.ajax({type:"POST",url:"/user/vote/submission/"+n+"/"+t.toString(),complete:function(){submissionVoteLock=null},error:function(){if(i)i.html("An Error Occurred :(");else{var r=$(".submission.id-"+n),t=r.children(".entry");t.children("span").remove();t.prepend('<span class="vote-error">An Error Occurred :(<\/span>')}},success:function(r){var f=$(".submission.id-"+n),s;if(f.children(".entry").children("span").remove(),!r.success){if(r.message.indexOf("2.2",0)>0?notEnoughCCP():(r.message.indexOf("4.0",0)>0||r.message.indexOf("2.1",0)>0)&&notEnoughCCPUpVote(),i){i.html(r.message);return}s=f.children(".entry");s.children("span").remove();s.prepend('<span class="vote-error">'+r.message+"<\/span>");return}var u=f.find(".voting-icons"),e=+f.find(".score.likes").html(),o=+f.find(".score.dislikes").html();t==1?u.is(".unvoted")?(u.toggleClass("likes",!0),u.toggleClass("unvoted",!1),u.children(".arrow-upvote").toggleClass("arrow-upvoted",!0),u.children(".arrow-upvote").toggleClass("arrow-upvote",!1),e++,f.find(".score.likes").html(e)):u.is(".likes")?(u.toggleClass("unvoted",!0),u.toggleClass("likes",!1),u.children(".arrow-upvoted").toggleClass("arrow-upvote",!0),u.children(".arrow-upvoted").toggleClass("arrow-upvoted",!1),e--,f.find(".score.likes").html(e),f.find(".score.unvoted").html(e)):u.is(".dislikes")&&(u.toggleClass("dislikes",!1),u.toggleClass("likes",!0),u.toggleClass("unvoted",!1),u.children(".arrow-downvoted").toggleClass("arrow-downvote",!0),u.children(".arrow-downvoted").toggleClass("arrow-downvoted",!1),u.children(".arrow-upvote").toggleClass("arrow-upvoted",!0),o--,e++,f.find(".score.dislikes").html(o),f.find(".score.likes").html(e)):u.is(".unvoted")?(u.toggleClass("dislikes",!0),u.toggleClass("unvoted",!1),u.children(".arrow-downvote").toggleClass("arrow-downvoted",!0),u.children(".arrow-downvote").toggleClass("arrow-downvote",!1),o++,f.find(".score.dislikes").html(o)):u.is(".dislikes")?(u.toggleClass("unvoted",!0),u.toggleClass("dislikes",!1),u.children(".arrow-downvoted").toggleClass("arrow-downvote",!0),u.children(".arrow-downvoted").toggleClass("arrow-downvoted",!1),o--,f.find(".score.dislikes").html(o),f.find(".score.unvoted").html(e)):u.is(".likes")&&(u.toggleClass("likes",!1),u.toggleClass("dislikes",!0),u.toggleClass("unvoted",!1),u.children(".arrow-upvoted").toggleClass("arrow-upvote",!0),u.children(".arrow-upvoted").toggleClass("arrow-upvoted",!1),u.children(".arrow-downvote").toggleClass("arrow-downvoted",!0),o++,e--,f.find(".score.dislikes").html(o),f.find(".score.likes").html(e))}}))}function voteComment(n,t){commentVoteLock==null&&(commentVoteLock={},t=t==-1?-1:1,$.ajax({type:"POST",url:"/user/vote/comment/"+n+"/"+t.toString(),complete:function(){commentVoteLock=null},error:function(){var i=$(".comment.id-"+n),t=i.children(".entry");t.children("span").remove();t.prepend('<span class="vote-error">An Error Occurred :(<\/span>')},success:function(i){var u=$(".comment.id-"+n),o;if(u.children(".entry").children("span").remove(),!i.success){i.message.indexOf("2.2",0)>0?notEnoughCCP():(i.message.indexOf("4.0",0)>0||i.message.indexOf("2.1",0)>0)&&notEnoughCCPUpVote();o=u.children(".entry");o.children("span").remove();o.prepend('<span class="vote-error">'+i.message+"<\/span>");return}var r=u.children(".midcol"),f=+u.find(".post_upvotes").filter(":first").html(),e=-u.find(".post_downvotes").filter(":first").html();t==1?(r.is(".unvoted")?(r.toggleClass("likes",!0),r.toggleClass("unvoted",!1),r.children(".arrow-upvote").toggleClass("arrow-upvoted",!0),r.children(".arrow-upvote").toggleClass("arrow-upvote",!1),f++):r.is(".likes")?(r.toggleClass("likes",!1),r.toggleClass("unvoted",!0),r.children(".arrow-upvoted").toggleClass("arrow-upvote",!0),r.children(".arrow-upvoted").toggleClass("arrow-upvoted",!1),f--):r.is(".dislikes")&&(r.toggleClass("dislikes",!1),r.toggleClass("likes",!0),r.toggleClass("unvoted",!1),r.children(".arrow-downvoted").toggleClass("arrow-downvote",!0),r.children(".arrow-downvoted").toggleClass("arrow-downvoted",!1),r.children(".arrow-upvote").toggleClass("arrow-upvoted",!0),f++,e--,u.find(".post_downvotes").filter(":first").html("-"+e)),u.find(".post_upvotes").filter(":first").html("+"+f),u.find(".score.unvoted").filter(":first").html(f-e+" points"),u.find(".score.onlycollapsed").filter(":first").html(f-e+" points")):(r.is(".unvoted")?(r.toggleClass("dislikes",!0),r.toggleClass("unvoted",!1),r.children(".arrow-downvote").toggleClass("arrow-downvoted",!0),r.children(".arrow-downvote").toggleClass("arrow-downvote",!1),e++):r.is(".dislikes")?(r.toggleClass("unvoted",!0),r.toggleClass("dislikes",!1),r.children(".arrow-downvoted").toggleClass("arrow-downvote",!0),r.children(".arrow-downvoted").toggleClass("arrow-downvoted",!1),e--):r.is(".likes")&&(r.toggleClass("likes",!1),r.toggleClass("dislikes",!0),r.toggleClass("unvoted",!1),r.children(".arrow-upvoted").toggleClass("arrow-upvote",!0),r.children(".arrow-upvoted").toggleClass("arrow-upvoted",!1),r.children(".arrow-downvote").toggleClass("arrow-downvoted",!0),f--,e++,u.find(".post_upvotes").filter(":first").html("+"+f)),u.find(".post_downvotes").filter(":first").html("-"+e),u.find(".score.unvoted").filter(":first").html(f-e+" points"),u.find(".score.onlycollapsed").filter(":first").html(f-e+" points"))}}))}function reply(n,t){if(!$("#commentreplyform-"+n).exists()&&!replyCommentFormRequest){replyCommentFormRequest=$.ajax({url:"/ajaxhelpers/commentreplyform/"+n+"/"+t,success:function(t){$("#"+n).append(t);$("#commentreplyform-"+n).find("#Content").focus()},complete:function(){replyCommentFormRequest=null}});var i=$("#commentreplyform-"+n).removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(i)}}function messageReplyForm(n){if(!$("#privatemessagereplyform-"+n).exists()&&!replyFormPMRequest){replyFormPMRequest=$.ajax({url:"/messages/reply/"+n+"?nocache="+cachePrevention(),success:function(t){$("#messageContainer-"+n).append(t);$("#privatemessagereplyform-"+n).find("#Body").focus()},complete:function(){replyFormPMRequest=null}});var t=$("#privatemessagereplyform-"+n).removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t)}}function replyToCommentNotification(n,t){if(!$("#commentreplyform-"+n).exists()&&!replyToCommentFormRequest){replyToCommentFormRequest=$.ajax({url:"/ajaxhelpers/commentreplyform/"+n+"/"+t,success:function(t){$("#commentContainer-"+n).append(t);$("#commentreplyform-"+n).find("#Content").focus()},complete:function(){replyToCommentFormRequest=null}});var i=$("#commentreplyform-"+n).removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(i)}}function getErrorObject(n){var t=n[2];return t.responseJSON&&t.responseJSON.success===!1?t.responseJSON:null}function getJsonResponse(n){var t=n[0];return t!==undefined&&t.responseJSON!==undefined?t.responseJSON:(t=n[2],t!==undefined&&t.responseJSON!==undefined)?t.responseJSON:n[0].status!=200?{success:!1,error:{type:n[0].status,message:n[0].statusText}}:{success:!1,data:n}}function getErrorMessage(n,t){var i=t?t:"You are doing that too fast. Please wait 30 seconds before trying again.";return n.length>0&&n!="Bad Request"&&n!="Internal Server Error"&&(i=n),i}function onSaveSet(n,t){var i=getJsonResponse(t),r=n.parents("form").find(".updateResult");i.success?r.html("Set updated"):r.html(i.error.message)}function submitSetUpdateForm(n,t){var i=function(n,i){var r=getJsonResponse(i),u=n.parents("form").find(".updateResult");r.success?r.data.fullName!=t?location.href="/s/"+r.data.fullName+"/about/details?message=Set%20Updated":u.html("Set Updated"):u.html(r.error.message)};submitForm(n,i)}function submitForm(n,t){var i=$(n).parents("form");$.ajax({type:"POST",url:i.attr("action"),data:i.serialize(),error:function(){t(n,arguments)},success:function(){t(n,arguments)}})}function submitComment(n,t){var i=$(n).parents("form");if(i.find("#errorMessage").toggle(!1),i.find("#Content").val().length>0)return i.find("#submitbutton").val("Please wait..."),i.find("#submitbutton").prop("disabled",!0),$.ajax({type:"POST",url:i.attr("action"),data:i.serialize(),error:function(){i.find("#submitbutton").val("Submit comment");i.find("#submitbutton").prop("disabled",!1);i.find("#errorMessage").html("An unexpected error happened");i.find("#errorMessage").toggle(!0)},success:function(n){var r=getErrorObject(arguments);r?(i.find("#submitbutton").val("Submit comment"),i.find("#submitbutton").prop("disabled",!1),i.find("#errorMessage").html(r.error.message),i.find("#errorMessage").toggle(!0)):t?(removereplyform(t),$(".id-"+t).append(n),window.setTimeout(function(){UI.Notifications.raise("DOM",$(".id-"+t).last("div"))})):($(".sitetable.nestedlisting > #no-comments").remove(),$(".sitetable.nestedlisting").prepend(n),i.find("#submitbutton").val("Submit comment"),i.find("#submitbutton").prop("disabled",!1),i.find("#Content").val(""),window.setTimeout(function(){UI.Notifications.raise("DOM",$(".sitetable.nestedlisting").first())}))}}),!1;i.find("#errorMessage").toggle(!0)}function postPrivateMessageReplyAjax(n,t){var i=$(n).parents("form");if(i.find("#errorMessage").toggle(!1),i.find("#Body").val().length>0)return i.find("#submitbutton").val("Please wait..."),i.find("#submitbutton").prop("disabled",!0),$.ajax({type:"POST",url:i.attr("action"),data:i.serialize(),error:function(n,t,r){var u=getErrorMessage(r);i.find("#submitbutton").val("Submit reply");i.find("#submitbutton").prop("disabled",!1);i.find("#errorMessage").html(u);i.find("#errorMessage").toggle(!0)},success:function(n){n.success?(removereplyform(t),$("#messageContainer-"+t).find("#replyPrivateMessage").html("Reply sent."),$("#messageContainer-"+t).find("#replyPrivateMessage").addClass("disabled")):(i.find("#submitbutton").val("Submit reply"),i.find("#submitbutton").prop("disabled",!1),i.find("#errorMessage").html(n.message),i.find("#errorMessage").toggle(!0))}}),!1;i.find("#errorMessage").toggle(!0)}function edit(n){$("#commentContent-"+n).toggle(1);$("#"+n).find(".usertext-edit").toggle(1);$("#commenteditform-"+n).find("#Content").focus();var t=$("#commenteditform-"+n).removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t)}function editSubmissionPrepareForm(n){$("#submissionid-"+n).find(".original").toggle(1);$("#submissionid-"+n).find(".usertext-edit").toggle(1);var t=$("#submissioneditform-"+n).removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t)}function removeSubmissionEditForm(n){$("#submissionid-"+n).find(".usertext-body").toggle(1);$("#submissionid-"+n).find(".usertext-edit").toggle(1)}function editSubmission(n){var t=$("#submissionid-"+n).find(".form-control").val(),i={SubmissionId:n,SubmissionContent:t};return $.ajax({type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),url:"/editsubmission",datatype:"json",error:function(t,i,r){var u=getErrorMessage(r,"Oops, a problem happened");$("#submissionid-"+n+" span.field-validation-error").html(u)},success:function(t){var i,r;t.success?(removeSubmissionEditForm(n),i=$("#submissionid-"+n+" .usertext-body"),i.children("div").first().html(t.data.formattedContent),i.show(),window.setTimeout(function(){UI.Notifications.raise("DOM",$("#submissionid-"+n))}),$("#submissionid-"+n+" span.field-validation-error").html("")):(r=t.error.message,$("#submissionid-"+n+" span.field-validation-error").html(r))}}),!1}function removereplyform(n){$("#replyform-"+n).remove()}function removeEditForm(n){$("#"+n).find(".usertext-body").show();$("#"+n).find(".usertext-edit").hide()}function toggleComment(n){var t=$("#"+n),i=t.closest(".noncollapsed").css("display")!="none";return t.closest(".noncollapsed").toggle(!i),t.prev().toggle(i),t.parent().parent().find(".midcol").filter(":first").toggle(!i),t.parent().parent().find("> .child").toggle(!i),t.parent().parent().find(".loadMoreComments").toggle(!i),!1}function showComment(n){return $("#"+n).closest(".noncollapsed").toggle(1),$("#"+n).prev().toggle(1),$("#"+n).parent().parent().find(".midcol").filter(":first").toggle(1),$("#"+n).parent().parent().find("> .child").toggle(1),!1}function hideComment(n){return $("#"+n).closest(".noncollapsed").toggle(1),$("#"+n).prev().toggle(1),$("#"+n).parent().parent().find(".midcol").filter(":first").toggle(1),$("#"+n).parent().parent().find("> .child").toggle(1),!1}function editCommentSubmit(n){var t=$("#"+n).find(".form-control").val(),i={ID:n,Content:t};return $.ajax({type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),datatype:"json",url:"/editcomment",error:function(t,i,r){var u=getErrorMessage(r,"Oops, a problem happened");$("#commenteditform-"+n+" span.field-validation-error").html(u)},success:function(t){t.success?($("#"+n).find(".md").html(t.data.formattedContent),removeEditForm(n),window.setTimeout(function(){UI.Notifications.raise("DOM",$("#"+n))})):$("#commenteditform-"+n+" span.field-validation-error").html(t.error.message)}}),!1}function deleteComment(n){$("#"+n).find(".flat-list").html("");$("#"+n).find(".md").html("[deleted]");$("#"+n).find(".md").css("color","gray");$("#"+n).find(".author").replaceWith(function(){return $("<em>[deleted]<\/em>")});$("#"+n).find(".userattrs").html("");toggleback(n);removeEditForm(n);deleteCommentSubmit(n)}function deleteCommentSubmit(n){var t={id:n};return $.ajax({type:"POST",url:"/deletecomment/"+n.toString()}),removeEditForm(commentid),!1}function deleteSubmission(n,t){var i=$(n).parents("form");i.find("#deletestatusmesssage").html("please wait...");$.ajax({type:"POST",url:"/deletesubmission/"+t.toString(),success:function(){window.location=$(location).attr("href")},error:function(){window.location=$(location).attr("href")}})}function getReportDialog(n,t,i,r){if(!reportDialogLock){var u="/v/"+t+"/about/reports/"+i+"/"+r+"/dialog?nocache="+cachePrevention();return reportDialogLock=$.ajax({type:"GET",url:u,success:function(t){$(n).hide();$(n).parents("div").first().append(t)},error:function(){$(n).text("Oops... a problem")},complete:function(){reportDialogLock=null}}),!1}}function cancelReportDialog(n){var t=$(n).parents(".reportDialog").first(),i=t.parent().find(".togglebutton");return i.show(),t.remove(),!1}function sendReport(n){var t=$(n).parents("form");return $.ajax({type:"POST",url:t.attr("action"),data:t.serialize(),error:function(){},success:function(){var u=getErrorObject(arguments),t=$(n).parents(".reportDialog").first(),i,r;u?(i=t.find(".error"),i.text(u.error.message),i.show()):(r=t.parent().find(".report-button"),r.show(),t.remove(),r.text("thank you!"))}}),!1}function markReportAsReviewed(n,t,i,r){var u="/v/"+t+"/about/reports/"+i+"/"+r+"/mark";return $.ajax({type:"POST",url:u,error:function(){$(n).parents(".contentReport").remove()},success:function(){var t=getErrorObject(arguments);t?$(n).val(t.error.message):$(n).parents(".contentReport").remove()}}),!1}function toggle(n){return $(n).parent().parent().find(".option, .main").toggleClass("active"),!1}function togglereport(n){return $("#"+n).find(".report").toggleClass("active"),!1}function reportContent(n,t,i){return $(n).parent().parent().find(".togglebutton").attr("onclick","javascript:void(0)"),$(n).parent().parent().find(".option, .main").toggleClass("active"),$(n).parent().parent().find(".togglebutton").html("please wait..."),$.ajax({type:"POST",url:"/report/"+t+"/"+i,success:function(){$(n).parent().parent().find(".togglebutton").html("thank you!")},error:function(){$(n).parent().parent().find(".togglebutton").html("report failed")}}),!1}function toggleback(n){return $(n).parent().parent().find(".option, .error").toggleClass("active"),!1}function togglesubmission(n){return $(n).parent().parent().find(".option, .main").toggleClass("active"),!1}function toggleSubmissionBack(n){return $(n).parent().parent().find(".option, .error").toggleClass("active"),!1}function setSubverseAddCallBack(n,t){var i=new getJsonResponse(t),r="";i.success?(r=i.data==!0?"Subverse added to set":i.data==!1?"Subverse removed from set":"No action was taken",$("input[data-autocomplete-subverse=1]").val("")):r="Oops: "+i.error.message;$(n).parents(".updateSection").find(".updateResult").html(r)}function setSubverseListToggleCallBack(n,t){var i=new getJsonResponse(t);i.success?toggleButtonVisualState(n,i.data,"remove","add"):n.text(i.error.message)}function setSubverseListToggle(n,t,i,r,u){var f,e;i!=""&&(f="toggle",r!==undefined&&r!=null&&(f=r),e="/s/"+t+"/"+i+"/"+f,$.ajax({type:"POST",url:e,complete:function(){u(n,arguments)}}))}function subscribe(n,t,i,r){var u="/user/subscribe/"+t+"/"+i+"/toggle";$.ajax({type:"POST",url:u,complete:function(){r(n,arguments)}})}function subscribeToSet(n,t){subscribe(n,"set",t,function(n,t){var i=getJsonResponse(t);i.success?toggleButtonVisualState(n,i.data,"unsubscribe","subscribe"):n.text(i.error.message)})}function subscribeToSubverse(n,t){subscribe(n,"subverse",t,function(n,t){var i=getJsonResponse(t);i.success?toggleButtonVisualState(n,i.data,"unsubscribe","subscribe"):n.text(i.error.message)})}function toggleButtonVisualState(n,t,i,r){t?(n.text(i),n.addClass("btn-voat-off"),n.addClass("btn-unsub"),n.removeClass("btn-sub")):(n.text(r),n.removeClass("btn-voat-off"),n.addClass("btn-sub"),n.removeClass("btn-unsub"))}function loadSelfText(n){$(n).toggleClass("collapsed");$(n).toggleClass("expanded");$(n).parent().find(".expando").toggle()}function deleteMessage(n,t,i,r){$(n).html("please wait...");var u="/messages/delete/"+t+"/"+($.isNumeric(i)?i:"")+(r?"?subverse="+r:"");return $.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:u,success:function(){$("#messageContainer-"+i).remove()},error:function(t,i,r){var u=getErrorMessage(r,"Oops, a problem happened");$(n).html(u)},datatype:"json"}),!1}function markAsRead(n,t,i,r,u){$(n).attr("onclick","");var f="/messages/mark/"+t+"/"+i+"/"+($.isNumeric(r)?r:"")+(u?"?subverse="+u:""),e=$.ajax({type:"POST",url:f,success:function(){$(n).text("marked");r?$("#messageContainer-"+r+" > .panel").toggleClass("unread"):($(".markAsReadLink").remove(),$(".unread").removeClass("unread"))},error:function(){$(n).text("something went wrong")}})}function selectflair(n,t){var i="/ajaxhelpers/linkflairselectdialog/"+t+"/"+n+"?nocache="+cachePrevention(),r=$.get(i,null,function(n){$("#linkFlairSelectModal").html(n);$("#linkFlairSelectModal").modal()})}function applyflair(n,t,i,r,u){$.ajax({type:"POST",url:"/submissions/applylinkflair/"+t+"/"+i,success:function(n){$("#linkFlairSelectModal").modal("hide");n.success&&($("#linkFlairSelectModal").modal("hide"),$("#linkflair").attr("class","flair "+u),$("#linkflair").attr("title",r),$("#linkflair").text(r))},error:function(){alert("Unable to apply link flair.")}})}function clearflair(n){$.ajax({type:"POST",url:"/submissions/clearlinkflair/"+n,success:function(){$("#linkFlairSelectModal").modal("hide");$("#linkflair").attr("class","");$("#linkflair").attr("title","");$("#linkflair").html("")},error:function(){alert("Unable to clear link flair.")}})}function distinguish(n,t){$(t).html("please wait...");$.ajax({type:"POST",url:"/comments/distinguish/"+n,success:function(){var r=$(t).parent().parent().parent().find(">.tagline"),n,i;r.find(">.author").toggleClass("moderator");n=r.find(">.userattrs");submitterAttr=n.find(">.submitter");moderatorAttr=n.find(">.moderator");n.html("");moderatorAttr.length>0?($(t).html("distinguish"),submitterAttr.length>0&&n.append(["[",submitterAttr,"]"])):($(t).html("undistinguish"),i=$(t).parent().parent().find(".bylink").attr("href").match(/^\/v\/([a-zA-Z0-9]+)\/(?:comments\/)?(\d+)/i),moderatorAttr=$("<a>M<\/a>"),moderatorAttr.attr("href","/v/"+i[1]+"/"+i[2]),moderatorAttr.attr("class","moderator"),moderatorAttr.attr("title","moderator"),submitterAttr.length>0?n.append(["[",submitterAttr,", "]):n.append("["),n.append([moderatorAttr,"]"]))},error:function(){$(t).html("unable to comply")}})}function suggestTitle(){$("#suggest-title").off("click",suggestTitle);$("#suggest-title").text("Please wait...");var n=$("#Url").val(),t=$.get("/ajaxhelpers/titlefromuri?uri="+n,null,function(n){$("#Title").val(n);$("#suggest-title").text("Enter the URL above, then click here to suggest a title");$("#suggest-title").on("click",suggestTitle)}).fail(function(){$("#Title").val("We were unable to suggest a title.");$("#suggest-title").text("Enter the URL above, then click here to suggest a title");$("#suggest-title").on("click",suggestTitle)})}function toggleSticky(n){$.ajax({type:"POST",url:"/submissions/togglesticky/"+n,success:function(n){n.success?$("#togglesticky").html("toggled"):$("#togglesticky").html(n.error.message)},error:function(){alert("Something went wrong while sending a sticky toggle request.")}})}function toggleNSFW(n){$.ajax({type:"POST",url:"/submissions/togglensfw/"+n,success:function(t){t.success?(t.data?$("#submissionid-"+n+" p.title").prepend('<span title="Not Safe For Work" class="flair linkflairlabel" id="nsfwflair">NSFW<\/span>'):$("#nsfwflair").remove(),$("#togglensfw").html("toggled")):$("#togglensfw").html(t.error.message)},error:function(){alert("Something went wrong while sending a nsfw toggle request.")}})}function showMessagePreview(n,t,i){var u=$(t).val(),r;return!u.length>0?($(i).find("#submission-preview-area-container").html("Please enter some text in order to get a preview."),$(i).show(),!1):($(n).val("Please wait"),r={MessageContent:$(t).val()},$.ajax({url:"/ajaxhelpers/rendersubmission/",type:"post",dataType:"html",success:function(n){$(i).find("#submission-preview-area-container").html(n);UI.ExpandoManager.execute()},data:r}),$(i).show(),$(n).val("Preview"),!1)}function toggleSource(n){$(n.parentElement.parentElement.parentElement).find("#sourceDisplay").toggle();n.text=n.text=="source"?"hide source":"source"}function loadMoreComments2(n,t,i,r,u,f,e){var o,s;loadCommentsRequest2||(n.html("Sit tight..."),o=$("#comments-"+i+"-page").html(),o==null?o=1:o++,s="/comments/"+i+"/"+(r==null?"null":r)+"/"+u+"/"+f+"/"+e+"?nocache="+cachePrevention(),loadCommentsRequest2=$.ajax({url:s,success:function(i){t.append(i);window.setTimeout(function(){UI.Notifications.raise("DOM",t)});wireTooltips();n.parent().remove()},error:function(){n.html("A problem happened.")},complete:function(){loadCommentsRequest2=null}}))}function cachePrevention(){return"xxxx".replace(/[xy]/g,function(){var n=Math.random()*16|0;return n.toString(16)})}function goToParent(n,t){$("#"+t).exists()&&(n.preventDefault(),window.location.hash="#"+t)}function scrollChatToBottom(n){var t=document.getElementById("subverseChatRoom"),i=t.scrollHeight-t.offsetHeight-t.scrollTop,r=i<100;(n===!0||r===!0)&&(t.scrollTop=t.scrollHeight)}function sendChatMessage(n,t){if($.connection!=null){var i=$("#chatInputBox").val(),r=$.connection.messagingHub;r.server.sendChatMessage(n,i,t);scrollChatToBottom(!0);$("#chatInputBox").val("")}}function joinChat(n,t){$.connection!=null&&$.connection.hub.start().done(function(){var i=$.connection.messagingHub;i.server.joinChat(n,t)})}function leaveChat(n){if($.connection!=null){var t=$.connection.messagingHub;t.server.leaveChat(n)}}function toggleNightMode(){$.ajax({type:"POST",url:"/account/togglenightmode/",complete:function(){window.location.reload()}})}function toggleSaveSubmission(n){var t=$(".submission.id-"+n+" .savelink"),i;t.exists()&&(t.text()==="save"?t.text("unsave"):t.text("save"),i="/user/save/submission/"+n.toString(),$.ajax({type:"POST",url:i}))}function toggleSaveComment(n){var t=$(".comment.id-"+n+" .savelink").first(),i;t.exists()&&(t.text()==="save"?t.text("unsave"):t.text("save"),i="/user/save/comment/"+n.toString(),$.ajax({type:"POST",url:i}))}function blockSubverseToggle(n,t){$(n).toggleClass("btn-blocksubverse btn-unblocksubverse");var i=$(n);i.exists()&&(toggleButtonVisualState(i,i.text()==="block","unblock","block"),postBlock("subverse",t))}function blockUserToggle(n,t){$(n).toggleClass("btn-blocksubverse btn-unblocksubverse");var i=$(n);i.exists()&&(toggleButtonVisualState(i,i.text()==="block","unblock","block"),postBlock("user",t))}function toggleBlockSubverseFLButton(n,t){var i=$(n);i.exists()&&(i.text()==="block subverse"?i.text("undo"):i.text("block subverse"),postBlock("subverse",t))}function postBlock(n,t){$.ajax({type:"POST",url:"/block/"+n,data:{name:t}})}function checkUsernameAvailability(n){if($(n).val().length>1&&!/\s/g.test($(n).val()))var t=$.ajax({type:"POST",url:"/account/CheckUsernameAvailability",data:{userName:$(n).val()},success:function(n){n.available?$("#usernameAvailabilityStatus").hide():$("#usernameAvailabilityStatus").show()}})}function previewStylesheet(n,t){function r(){$("[id=custom_css]").remove();var n=document.createElement("style");n.setAttribute("id","custom_css");n.innerHTML=$("#Stylesheet").val();document.body.appendChild(n)}var i,u;$.trim($("#stylesheetpreviewarea").html())==""?(i=$(n),i.html("Hold on..."),i.prop("disabled",!0),u="/ajaxhelpers/previewstylesheet?subverse="+t+"&previewMode=true&nocache="+cachePrevention(),$.ajax({type:"GET",url:u,dataType:"html",success:function(n){$("#stylesheetpreviewarea").html(n);i.html("Preview");i.prop("disabled",!1);registerDashboardHandler();r()}})):r()}function getCommentTree(n,t){$("#comment-sort-label").text("Loading...");$.ajax({type:"GET",url:"/comments/"+n+"/tree/"+t+"?nocache="+cachePrevention(),dataType:"html",error:function(){},success:function(n){$(".commentarea").html(n);window.setTimeout(function(){UI.Notifications.raise("DOM",$(".commentarea"));wireTooltips()})}})}function addTagsToEachSelectedTextLine(n,t,r){var u=getSelectionArray(n),e=u[1].split("\n"),f;for(n.value=u[0],i=0;i<e.length;i++)n.value+=addTagsToText(e[i],t,r)+"\n";n.value+=u[2];f=n.value.length-r.length-u[2].length;setSelectionRange(n,f,f)}function addTagsToSelectedText(n,t,i){var r=getSelectionArray(n),u;n.value=r[0];n.value+=addTagsToText(r[1],t,i);n.value+=r[2];u=n.value.length-i.length-r[2].length;setSelectionRange(n,u,u)}function addTagsToText(n,t,i){return t+n+i}function getSelectionArray(n){var t=[n.value,"",""],i,r;return n.selectionStart!=undefined&&(i=n.selectionStart,r=n.selectionEnd,t[0]=n.value.substring(0,i),t[1]=n.value.substring(i,r),t[2]=n.value.substring(r,n.value.length)),t}function setSelectionRange(n,t,i){if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,i);else if(n.createTextRange){var r=n.createTextRange();r.collapse(!0);r.moveEnd("character",i);r.moveStart("character",t);r.select()}}function incColumns(n,t){n.value++;updateNumColumnsDisplay(n,t)}function decColumns(n,t){n.value>1&&n.value--;updateNumColumnsDisplay(n,t)}function updateNumColumnsDisplay(n,t){t.innerHTML=n.value}function incRows(n,t){n.value++;updateNumRowsDisplay(n,t)}function decRows(n,t){n.value>1&&n.value--;updateNumRowsDisplay(n,t)}function updateNumRowsDisplay(n,t){t.innerHTML=n.value}function createTable(n,t,i){var u=getSelectionArray(n),f;if(t>=1&&i>=1){for(n.value=u[0],c=0;c<t;c++)n.value+="Title |";for(n.value+="\n",c=0;c<t;c++)n.value+="--- |";for(n.value+="\n",r=0;r<i;r++){for(c=0;c<t;c++)n.value+="Text |";n.value+="\n"}n.value+=u[2];f=n.value.length-u[2].length;setSelectionRange(n,f,f)}else alert("Error: Unable to create table! Invalid number of columns/rows.")}function addHyperlink(n,t){t!=""&&t!==null&&(getSelectionArray(n)[1]==""?addTagsToSelectedText(n,"[Title Here","]("+t+")"):addTagsToSelectedText(n,"[","]("+t+")"));n.focus()}function addCode(n){var t=getSelectionArray(n),r,i;n.value=t[0];r=/\r|\n/.exec(t[1])||t[1].length==0;n.value+=r?addTagsToText(t[1],"~~~\n","\n~~~"):addTagsToText(t[1],"`","`");n.value+=t[2];i=n.value.length-rightTag.length-t[2].length;setSelectionRange(n,i,i)}var UI,LinkExpando,ImageLinkExpando,VideoLinkExpando,GfycatExpando,ImgurGifvExpando,WebMExpando,MP4Expando,IFrameEmbedderExpando,YouTubeExpando,HookTubeExpando,VidmeExpando,ImgurAlbumExpando,VimeoExpando,CoubExpando,SoundCloudExpando,submissionVoteLock,commentVoteLock,replyCommentFormRequest,replyFormPMRequest,replyToCommentFormRequest,reportDialogLock,loadCommentsRequest2,voat;registerDashboardHandler();UI=window.UI||{};UI.Notifications=function(){function t(t,i){n.forEach(function(n){n.event==t&&n.callback(i)})}var n=[];return{subscribe:function(t,i){n.push({event:t,callback:i})},unSubscribe:function(t,i){n=n.filter(function(n){if(n.event!=t||n.callback!=i)return n})},clear:function(t){n=n.filter(function(n){if(n.event!==t)return n})},raise:function(n,i){t(n,i)}}}();UI.Common={debug:!1,availableWidth:function(n){return $(n).innerWidth()},htmlEscape:function(n){return String(n).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},isMobile:function(){return!1},isCommentPage:function(){return/\/comments\//i.test(window.location.href)},isMessagePage:function(){return/\/messaging\//i.test(window.location.href)},fileExtension:function(n,t){if(n)try{var i=/\.+\w+$/i.exec(n);if(i&&i.length>0)return t?i[0]:i[0].replace(".","")}catch(r){return""}return""},getDomainName:function(){return"notdone.com"},currentDomainRoot:function(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")},currentProtocol:function(){return location.protocol},resolveUrl:function(n){return n?n.indexOf("http")==0||n.indexOf("ftp")==0?n:n.indexOf("~/")==0?UI.Common.currentDomainRoot().concat("/",n.replace("~/","")):n.indexOf("/")==0?UI.Common.currentDomainRoot().concat(n):UI.Common.currentDomainRoot().concat("/",n):n},queryString:function(n,t){var r,e,i,u;if(t&&t.length!=0||(t=location.href),t.indexOf("?")>0){for(var o=t.split("?")[1],s=o.split("&"),f=[];i<s.length;i++)r=kv.split("="),e=r[1],f.push({key:r[0],value:unescape(e)});for(i=0;i<keypairs.length;i++)if(u=f[i],u.key==n)return u.value}return null},resizeTarget:function(n,t,i){try{var e=!1,u=n.prop("width"),f=n.prop("height");(u==0||f==0)&&(u=parseInt(n.css("width")),f=parseInt(n.css("height")),e=!0);var o=u/f,s=typeof i=="object"?i:n.parent(),r=UI.Common.availableWidth(s);(r<u||t&&r>u)&&(e?(n.css("width",r),n.css("height",r/o)):(n.prop("width",r),n.prop("height",r/o)))}catch(h){if(UI.Common.debug)throw h;}}};UI.ExpandoManager=function(){UI.Notifications.subscribe("DOM",function(n){UI.ExpandoManager.execute(n)});var n=[];return{addExpando:function(t,i){var r=n.filter(function(n){if(n.selector==t)return n});r.length>0?i instanceof Array?r[0].group=r[0].group.concat(i):r[0].group.push(i):i instanceof Array?n.push({selector:t,group:i}):n.push({selector:t,group:[i]})},reset:function(){n=[]},execute:function(t){n&&n.length>0&&n.forEach(function(n){var i=t==undefined?$(n.selector):$(n.selector,t);i.length>0&&n.group.forEach(function(n){i.filter(function(){if(!n.preConditionMet||n.preConditionMet&&n.preConditionMet())try{return n.getFilter().test(this.href)}catch(t){}return!1}).each(function(t,i){n.process(i)})})})}}}();LinkExpando=function(n,t){var i=n;this.options=t;this.getFilter=function(){return i};this.getId=function(n){var t=undefined;try{t=this.getFilter().exec(n)[1]}catch(i){}return t}};LinkExpando.prototype={process:function(){UI.Common.debug&&alert("Class LinkExpando.process(target) method must be overridden in derived class.")}};LinkExpando.setDirectLink=function(n,t,i){var r=$("<span/>",{"class":"tagline"}).html(t+" ").append($("<a/>",{"class":"link-expando-direct",target:"_blank",href:i}).text("Open"));n.append(r)};LinkExpando.setTag=function(n,t){n.data("text")===undefined&&n.data("text",n.text());t?n.html(UI.Common.htmlEscape(n.data("text")).concat("<span class='link-expando-type'>",t,"<\/span>")):n.text(UI.Common.htmlEscape(n.data("text")))};LinkExpando.dataProp=function(n,t,i){return i!=null&&$(n).data(t,i),$(n).data(t)};LinkExpando.isLoaded=function(n,t){return LinkExpando.dataProp(n,"loaded",t)};LinkExpando.isVisible=function(n,t){return LinkExpando.dataProp(n,"visible",t)};LinkExpando.isHooked=function(n,t){return LinkExpando.dataProp(n,"hooked",t)};LinkExpando.toggle=function(n){n.slideToggle()};ImageLinkExpando=function(){var n=0;return function(t){LinkExpando.call(this,/^([^\?]+(\.(jpg|jpeg|gif|giff|png)))$/i,t);this.autoLoadedCount=function(){return n};this.process=function(n){var i=this.options.targetFunc?this.options.targetFunc($(n)):$(n),n=$(n),u,r;if(!LinkExpando.isHooked(i)){u=this;i.on("click",function(n){u.onClick(n)});LinkExpando.isHooked(i,!0);r=UI.Common.fileExtension(n.prop("href")).toUpperCase();i.prop("title",r);t.setTags&&LinkExpando.setTag(i,r);LinkExpando.dataProp(i,"src",n.prop("href"));UI.ImageExpandoSettings.autoLoad?this.loadImage(i,n.prop("href")):UI.ImageExpandoSettings.autoShow&&i.click()}};this.onClick=function(n){n.preventDefault();var t=this.options.targetFunc($(n.target));LinkExpando.isVisible(t)?(LinkExpando.toggle(this.options.destinationFunc(t),!1),this.options.toggle&&this.options.toggle(t),LinkExpando.isVisible(t,!1)):LinkExpando.isLoaded(t)?(LinkExpando.isVisible(t,!0),LinkExpando.toggle(this.options.destinationFunc(t),!0),this.options.toggle&&this.options.toggle(t)):this.loadImage(t,LinkExpando.dataProp(t,"src"))};this.loadImage=function(n,t,i){var u,r;this.options.loading&&this.options.loading(n);this.options.setTags&&LinkExpando.setTag(n,"loading");LinkExpando.dataProp(n,"src",t);n.off();n.on("click",function(n){n.preventDefault()});u=new Image;u.onerror=function(){u.src=UI.Common.resolveUrl(UI.ImageExpandoSettings.errorImageUrl)};r=this;u.onload=function(){var o,s,h,c;if(this.complete){var v=n.parent(),l=r.options.destinationFunc(n),e=l,u=$(this),f=this.width,a=this.height;e.html(u);o=UI.Common.fileExtension(t).toUpperCase().concat(" Â· ",f.toString()," x ",a.toString());LinkExpando.setDirectLink(e,o,t);n.prop("title",o);this.removeAttribute("width");this.removeAttribute("height");u.css("min-width",Math.min(f,68));u.css("max-width",f);u.data("nwidth",f);u.attr("draggable",!1);u.attr("oncontextmenu","return false");u.on("mousedown",function(n){if(n.which===3){u.css("width",f);n.preventDefault();return}s={x:n.pageX,origWidth:u.width()};$("body").on("mousemove",h);$("body").on("mouseup",c)});h=function(n){var t=n.pageX-s.x;u.css("width",s.origWidth+t);u.css("max-width","")};c=function(){$("body").off("mousemove",h);$("body").off("mouseup",c)};LinkExpando.isLoaded(n,!0);n.off();n.on("click",function(t){LinkExpando.isVisible(n)||(u.css("max-width",f),u.css("width",""));r.onClick(t)});r.options.setTags&&LinkExpando.setTag(n,UI.Common.fileExtension(t).toUpperCase());i||(LinkExpando.isVisible(n,!0),r.options.toggle&&r.options.toggle(n),LinkExpando.toggle(e,!0));i&&UI.ImageExpandoSettings.autoShow&&n.click()}};u.src=t}}}();ImageLinkExpando.prototype=new LinkExpando;ImageLinkExpando.prototype.constructor=ImageLinkExpando;VideoLinkExpando=function(){var n=document.createElement("video");return function(t){LinkExpando.call(this,t);this.isMP4Supported=function(){return this.isSupported("video/mp4","avc1.42E01E,mp4a.40.2")};this.isWEBMSupported=function(){return this.isSupported("video/webm","vp8.0,vorbis")};this.isSupported=function(t,i){if(n.canPlayType){var r=n.canPlayType(t+";"+(i?' codecs="'+i+'"':""));return["probably","maybe"].indexOf(r)>=0}return!1};this.isVideoSupported=function(){return this.isMP4Supported()||this.isWEBMSupported()};this.embedVideo=function(n,t,i,r){var f=$("<video/>",t),e=this.options.targetFunc(n),o,u;if(e.prop("title",r),i.length>0)for(o=0;o<i.length;o++)f.append($("<source/>",i[o]));else return;return u=this.options.destinationFunc(e),UI.Common.resizeTarget(f,!1,u.parent()),t.muted&&$(f).prop("muted",!0),u.empty().append(f),this.options.setTags&&LinkExpando.setTag(e,r),LinkExpando.setDirectLink(u,r,n.prop("href")),LinkExpando.isLoaded(e,!0),u};this.PausePlayToggle=function(n){this.options.toggle(n);var t=this;this.options.destinationFunc(n).slideToggle(400,function(){var r=LinkExpando.isVisible(n),u=LinkExpando.isLoaded(n),i=t.options.destinationFunc(n).find("video").get(0);i!=null&&(r&&u?i.play():i.pause())})}}}();VideoLinkExpando.prototype=new LinkExpando;VideoLinkExpando.prototype.constructor=VideoLinkExpando;GfycatExpando=function(n){LinkExpando.call(this,/gfycat\.com\/([A-Z]{1}[a-z]+[A-Z]{1}[a-z]+[A-Z]{1}[a-z]+)/,n);this.hook=function(n){var t=this.options.targetFunc(n),i;if(t.prop("title","Gfycat"),!LinkExpando.isHooked(t)){LinkExpando.isHooked(t,!0);LinkExpando.dataProp(t,"id",this.getId(n.prop("href")));i=this;t.on("click",function(r){if(r.preventDefault(),LinkExpando.isLoaded(t))LinkExpando.isVisible(t,!LinkExpando.isVisible(t));else{i.options.loading&&i.options.loading(t);i.options.setTags&&LinkExpando.setTag(t,"loading");function u(){i.options.setTags&&LinkExpando.setTag(t,"Error");t.off("click")}i.getSourceInfo(LinkExpando.dataProp(t,"id"),function(r){if(!r.gfyItem){u();return}if(i.isVideoSupported()){var f=i.embedVideo(n,{width:r.gfyItem.width,height:r.gfyItem.height,autoplay:1,loop:1,muted:1},[{id:"mp4gfycat",src:r.gfyItem.mp4Url,type:"video/mp4"},{id:"webmgfycat",src:r.gfyItem.webm,type:"video/webm"}],"Gfycat Video");LinkExpando.isLoaded(t,!0);LinkExpando.isVisible(t,!0)}else ImageLinkExpando.loadImage(t,r.gfyItem.gifUrl)},u)}i.PausePlayToggle(t)});i.options.setTags&&LinkExpando.setTag($(t),"Gfycat")}};this.getSourceInfo=function(n,t,i){try{$.ajax({url:UI.Common.currentProtocol()+"//gfycat.com/cajax/get/"+n,type:"GET"}).done(t).fail(i)}catch(r){i()}}};GfycatExpando.prototype=new VideoLinkExpando;GfycatExpando.prototype.constructor=GfycatExpando;GfycatExpando.prototype.process=function(n){this.hook($(n))};ImgurGifvExpando=function(n){LinkExpando.call(this,/i\.imgur\.com\/([^"&?\/\.]*)\.gifv/i,n);this.getSrcUrl=function(n,t){return"http://i.imgur.com/".concat(n,t)};this.hook=function(n){var t=this.options.targetFunc(n),i;if(t.prop("title","Gifv"),!LinkExpando.isHooked(t)){LinkExpando.isHooked(t,!0);LinkExpando.dataProp(t,"id",this.getId(n.prop("href")));i=this;t.on("click",function(r){var u,f;r.preventDefault();u=i.getId(n.prop("href"));LinkExpando.isLoaded(t)?LinkExpando.isVisible(t,!LinkExpando.isVisible(t)):(i.options.setTags&&LinkExpando.setTag(t,"loading"),i.isVideoSupported()?(f=i.embedVideo(n,{width:"100%",height:"auto",autoplay:1,loop:1,muted:1},[{id:"mp4source",src:i.getSrcUrl(u,".mp4"),type:"video/mp4"},{id:"webmsource",src:i.getSrcUrl(u,".webm"),type:"video/webm"}],"Gifv Video"),LinkExpando.isLoaded(t,!0),LinkExpando.isVisible(t,!0)):(t.off("click"),LinkExpando.setTag(t)));i.PausePlayToggle(t)});i.options.setTags&&LinkExpando.setTag($(t),"Gifv")}}};ImgurGifvExpando.prototype=new VideoLinkExpando;ImgurGifvExpando.prototype.constructor=ImgurGifvExpando;ImgurGifvExpando.prototype.process=function(n){this.hook($(n))};WebMExpando=function(n){LinkExpando.call(this,/(.+\.webm)/i,n);this.preConditionMet=function(){return this.isWEBMSupported()};this.hook=function(n){var t=this.options.targetFunc(n),i;if(t.prop("title","WebM"),!LinkExpando.isHooked(t)){LinkExpando.isHooked(t,!0);LinkExpando.dataProp(t,"id",this.getId(n.prop("href")));i=this;t.on("click",function(r){var u,f;r.preventDefault();u=n.prop("href");LinkExpando.isLoaded(t)?LinkExpando.isVisible(t,!LinkExpando.isVisible(t)):(i.options.setTags&&LinkExpando.setTag(t,"loading"),i.isWEBMSupported()?(f=i.embedVideo(n,{width:"100%",height:"auto",autoplay:1,loop:1,muted:1},[{id:"webmsource",src:u,type:"video/webm"}],"WebM Video"),LinkExpando.isLoaded(t,!0),LinkExpando.isVisible(t,!0)):(t.off("click"),LinkExpando.setTag(t)));i.PausePlayToggle(t)});i.options.setTags&&LinkExpando.setTag($(t),"WebM")}}};WebMExpando.prototype=new VideoLinkExpando;WebMExpando.prototype.constructor=WebMExpando;WebMExpando.prototype.process=function(n){this.hook($(n))};MP4Expando=function(n){LinkExpando.call(this,/(.+\.mp4)/i,n);this.preConditionMet=function(){return this.isMP4Supported()};this.hook=function(n){var t=this.options.targetFunc(n),i;if(t.prop("title","MP4"),!LinkExpando.isHooked(t)){LinkExpando.isHooked(t,!0);LinkExpando.dataProp(t,"id",this.getId(n.prop("href")));i=this;t.on("click",function(r){var u,f;r.preventDefault();u=n.prop("href");LinkExpando.isLoaded(t)?LinkExpando.isVisible(t,!LinkExpando.isVisible(t)):(i.options.setTags&&LinkExpando.setTag(t,"loading"),i.isMP4Supported()?(f=i.embedVideo(n,{width:"100%",height:"auto",autoplay:1,loop:1,muted:1},[{id:"mp4source",src:u,type:"video/mp4"}],"MP4 Video"),LinkExpando.isLoaded(t,!0),LinkExpando.isVisible(t,!0)):(t.off("click"),LinkExpando.setTag(t)));i.PausePlayToggle(t)});i.options.setTags&&LinkExpando.setTag($(t),"MP4")}}};MP4Expando.prototype=new VideoLinkExpando;MP4Expando.prototype.constructor=WebMExpando;MP4Expando.prototype.process=function(n){this.hook($(n))};IFrameEmbedderExpando=function(n,t){LinkExpando.call(this,n,t);this.defaultRatio=.5625;this.hook=function(n,t,i){var u=this.options.targetFunc(n),f,r;if(!LinkExpando.isHooked(u)&&(LinkExpando.isHooked(u,!0),f=this.getId(n.prop("href")),f)){u.prop("title",t);r=this;u.on("click",function(u){var e,o,s,h;u.preventDefault();e=r.options.targetFunc($(u.target));o=r.options.destinationFunc(e);LinkExpando.isLoaded(e)||(r.options.loading&&r.options.loading(e),s=function(){r.options.setTags&&LinkExpando.setTag(e,"Error");e.off("click")},h=function(r){LinkExpando.dataProp(e,"source",r);i.src=LinkExpando.dataProp(e,"source");i.width=i.width==0?"100%":i.width;i.height=i.height==0?"100%":i.height;var u=$("<iframe/>",i);o.empty().html(u);LinkExpando.setDirectLink(o,t,n.prop("href"));LinkExpando.isLoaded(e,!0);UI.Common.resizeTarget($("iframe",o),!1,e.parent())},r.getSrcUrl(f,h,s));LinkExpando.isVisible(e,!LinkExpando.isVisible(e));r.options.toggle(e);r.options.destinationFunc(e).slideToggle(400,function(){!LinkExpando.isVisible(e)&&LinkExpando.isLoaded(e)&&(o.empty(),LinkExpando.isLoaded(e,!1))})});r.options.setTags&&LinkExpando.setTag(u,t)}}};IFrameEmbedderExpando.prototype=new LinkExpando;IFrameEmbedderExpando.prototype.constructor=IFrameEmbedderExpando;YouTubeExpando=function(n){IFrameEmbedderExpando.call(this,/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11}(?:[?&]t=(?:(?:\d+[hms]){1,3}|\d+))?)/i,n);this.getSrcUrl=function(n,t){var r=n.match(/([^?&]+)(?:[?&]t=((?:(?:\d+[hms]){1,3}|\d+)))?/),u="",i,f=0;n=r[1];typeof r[2]!="undefined"&&(u="?start=",i=r[2].match(/^(\d+)$/),i!==null?u+=parseInt(i[1],10):(i=r[2].match(/(\d+)h/),i!==null&&(f+=parseInt(i[1],10)*3600),i=r[2].match(/(\d+)m/),i!==null&&(f+=parseInt(i[1],10)*60),i=r[2].match(/(\d+)s/),i!==null&&(f+=parseInt(i[1],10)),u+=f));t("//www.youtube.com/embed/"+n+u)}};YouTubeExpando.prototype=new IFrameEmbedderExpando;YouTubeExpando.prototype.constructor=YouTubeExpando;YouTubeExpando.prototype.process=function(n){var i=this.options.targetFunc($(n)),t=Math.min(560,UI.Common.availableWidth(i.parent()));this.hook($(n),"YouTube",{width:t.toString(),height:(t*this.defaultRatio).toString(),frameborder:"0",allowfullscreen:!0})};HookTubeExpando=function(n){IFrameEmbedderExpando.call(this,/(?:hooktube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)?|youtu\.be\/)([^"&?\/ ]{11}(?:[?&]t=(?:(?:\d+[hms]){1,3}|\d+))?)/i,n);this.getSrcUrl=function(n,t){var r=n.match(/([^?&]+)(?:[?&]t=((?:(?:\d+[hms]){1,3}|\d+)))?/),u="",i,f=0;n=r[1];typeof r[2]!="undefined"&&(u="?start=",i=r[2].match(/^(\d+)$/),i!==null?u+=parseInt(i[1],10):(i=r[2].match(/(\d+)h/),i!==null&&(f+=parseInt(i[1],10)*3600),i=r[2].match(/(\d+)m/),i!==null&&(f+=parseInt(i[1],10)*60),i=r[2].match(/(\d+)s/),i!==null&&(f+=parseInt(i[1],10)),u+=f));t("//hooktube.com/embed/"+n+u)}};HookTubeExpando.prototype=new IFrameEmbedderExpando;HookTubeExpando.prototype.constructor=YouTubeExpando;HookTubeExpando.prototype.process=function(n){var i=this.options.targetFunc($(n)),t=Math.min(560,UI.Common.availableWidth(i.parent()));this.hook($(n),"HookTube",{width:t.toString(),height:(t*this.defaultRatio).toString(),frameborder:"0",allowfullscreen:!0})};VidmeExpando=function(n){IFrameEmbedderExpando.call(this,/(?:https?\:\/\/)?(?:.*vid\.me)\/(.+)/i,n);this.getSrcUrl=function(n,t){t("//www.vid.me/e/"+n+"?stats=1")}};VidmeExpando.prototype=new IFrameEmbedderExpando;VidmeExpando.prototype.constructor=VidmeExpando;VidmeExpando.prototype.process=function(n){var i=this.options.targetFunc($(n)),t=Math.min(560,UI.Common.availableWidth(i.parent()));this.hook($(n),"vid.me",{width:t.toString(),height:(t*this.defaultRatio).toString(),frameborder:"0",allowfullscreen:!0})};ImgurAlbumExpando=function(n){IFrameEmbedderExpando.call(this,/imgur\.com\/a\/(\w+)\/?/i,n);this.hook=function(n,t){var r=this.options.targetFunc(n),u,i;if(!LinkExpando.isHooked(r)&&(LinkExpando.isHooked(r,!0),u=this.getId(n.prop("href")),u)){r.prop("title",t);i=this;r.on("click",function(r){var f,e,o;r.preventDefault();f=i.options.targetFunc($(r.target));e=i.options.destinationFunc(f);LinkExpando.isLoaded(f)||(i.options.loading&&i.options.loading(f),o=function(){var i='<blockquote class="imgur-embed-pub" lang="en" data-id="a/'+u+'"><a href="//imgur.com/'+u+'">Imgur Album<\/a><\/blockquote><script async src="//s.imgur.com/min/embed.js" charset="utf-8"><\/script>';e.empty().html(i);LinkExpando.setDirectLink(e,t,n.prop("href"));LinkExpando.isLoaded(f,!0)},o());LinkExpando.isVisible(f,!LinkExpando.isVisible(f));i.options.toggle(f);i.options.destinationFunc(f).slideToggle(400,function(){!LinkExpando.isVisible(f)&&LinkExpando.isLoaded(f)&&(e.empty(),LinkExpando.isLoaded(f,!1))})});i.options.setTags&&LinkExpando.setTag(r,t)}}};ImgurAlbumExpando.prototype=new IFrameEmbedderExpando;ImgurAlbumExpando.prototype.constructor=ImgurAlbumExpando;ImgurAlbumExpando.prototype.process=function(n){var t=Math.min(560,UI.Common.availableWidth($(n).parent()));this.hook($(n),"Imgur Album",{width:t.toString(),height:(t*.8).toString(),frameborder:"0"})};VimeoExpando=function(n){IFrameEmbedderExpando.call(this,/vimeo\.com\/(?:.\*|.*\/)?([\d]+)\/?/i,n);this.getSrcUrl=function(n,t){t("//player.vimeo.com/video/"+n)}};VimeoExpando.prototype=new IFrameEmbedderExpando;VimeoExpando.prototype.constructor=VimeoExpando;VimeoExpando.prototype.process=function(n){var t=Math.min(560,UI.Common.availableWidth($(n).parent()));this.hook($(n),"Vimeo",{width:t.toString(),height:t*this.defaultRatio,frameborder:"0",webkitallowfullscreen:1,mozallowfullscreen:1,allowfullscreen:1})};CoubExpando=function(n){IFrameEmbedderExpando.call(this,/coub\.com\/(?:v|view|embed)\/(\w+)/i,n);this.getSrcUrl=function(n,t){t("//coub.com/embed/"+n)}};CoubExpando.prototype=new IFrameEmbedderExpando;CoubExpando.prototype.constructor=CoubExpando;CoubExpando.prototype.process=function(n){var t=Math.min(560,UI.Common.availableWidth($(n).parent()));this.hook($(n),"Coub",{width:t.toString(),height:t*this.defaultRatio,frameborder:"0",webkitallowfullscreen:1,mozallowfullscreen:1,allowfullscreen:1})};SoundCloudExpando=function(n){IFrameEmbedderExpando.call(this,/http(?:s{0,1}):\/\/(?:soundcloud\.com|snd\.sc)\/(.*)\/?/i,n);this.getSrcUrl=function(n,t,i){this.getSourceInfo=function(n,r,u){$.getJSON(UI.Common.currentProtocol()+"//soundcloud.com/oembed",{format:"json",url:"https://soundcloud.com/"+n,iframe:"true"}).done(function(n){n.html||(u(),i());var r=/<iframe.*?src="(.*?)"/.exec(n.html)[1];t(r+"&auto_play=true")}).fail(function(){i()})};this.getSourceInfo(n,t,i)}};SoundCloudExpando.prototype=new IFrameEmbedderExpando;SoundCloudExpando.prototype.constructor=SoundCloudExpando;SoundCloudExpando.prototype.process=function(n){var t=Math.min(560,UI.Common.availableWidth($(n).parent()));this.hook($(n),"SoundCloud",{width:t.toString(),height:t*this.defaultRatio,frameborder:"0"})};UI.ImageExpandoSettings=function(){return{autoLoad:!1,autoShow:!1,initialSize:0,errorImageUrl:"~/images/missing_image.png"}}();UI.SidebarHandler=function(){function u(){t.toggleClass("show-mobile-sidebar",!1);n.toggleClass("show-mobile-sidebar",!1);i.toggleClass("show-mobile-sidebar",!1);r.toggleClass("show-mobile-sidebar",!1)}function e(n){n.matches&&u()}var f;if(!$(".side").exists()){$("#show-menu-button").hide();return}var i=$(".side"),n=$("#show-menu-button"),t=$("#modal-background"),r=$("body");n.on("click",function(){t.toggleClass("show-mobile-sidebar");n.toggleClass("show-mobile-sidebar");i.toggleClass("show-mobile-sidebar");r.toggleClass("show-mobile-sidebar")});t.on("click",function(){u()});f=window.matchMedia("(min-width: 870px)");f.addListener(e)};$(document).ready(function(){var n,t;UI.Common.debug=!1;n={targetFunc:function(n){var t=n;return t.is("span")&&(t=n.parent()),t},destinationFunc:function(n){var r=this.targetFunc(n),t=n.next(".link-expando"),i;return t.length==0&&(i=$("<div/>",{"class":"link-expando",style:"display:none;"}),i.insertAfter(n),t=n.next(".link-expando")),t},toggle:function(){},setTags:!0};UI.ExpandoManager.addExpando(".usertext-body > .md a:not(.link-expando-direct), .panel-message-body a:not(.link-expando-direct)",[new ImageLinkExpando(n),new YouTubeExpando(n),new VidmeExpando(n),new VimeoExpando(n),new CoubExpando(n),new GfycatExpando(n),new SoundCloudExpando(n),new ImgurAlbumExpando(n),new ImgurGifvExpando(n),new WebMExpando(n),new MP4Expando(n),new HookTubeExpando(n)]);t={targetFunc:function(n){var t=n.parent().parent().find(".expando-button"),i;return t.length==0&&(i=$("<div/>",{"class":"expando-button collapsed selftext"}),i.insertAfter(n.parent()),t=n.parent().parent().find(".expando-button")),t},destinationFunc:function(n){var t=n.parent().find(".expando"),i;return t.length==0&&(i=$("<div/>",{"class":"expando collapsed link-expando",style:"display:none;"}),n.parent().append(i),t=n.parent().find(".expando")),t.hasClass("link-expando")||t.addClass("link-expando"),t},toggle:function(n){n.hasClass("loading")?(n.addClass("expanded"),n.removeClass("loading"),n.removeClass("collapsed")):n.hasClass("collapsed")?(n.removeClass("collapsed"),n.addClass("expanded")):(n.removeClass("expanded"),n.addClass("collapsed"))},loading:function(n){n.addClass("loading");n.removeClass("collapsed");n.removeClass("expanded")},setTags:!1};UI.ExpandoManager.addExpando(".submission .entry .title a:not(.link-expando-direct)",[new ImageLinkExpando(t),new YouTubeExpando(t),new VidmeExpando(t),new VimeoExpando(t),new CoubExpando(t),new GfycatExpando(t),new SoundCloudExpando(t),new ImgurAlbumExpando(t),new ImgurGifvExpando(t),new WebMExpando(t),new MP4Expando(t),new HookTubeExpando(t)]);UI.ExpandoManager.execute();UI.Notifications.subscribe("iFrameLoaded",function(n){var t=$("iframe",n);t&&UI.Common.resizeTarget(t,!1,t.parent())});$(window).on("resize",function(){$(".link-expando img").each(function(){var n=$(this).data("nwidth");$(this).css({width:"","max-width":n})})});UI.SidebarHandler()});$(document).ready(function(){var t="VoatRequestVerificationToken",i,n;$('[data-toggle="popover"]').popover({trigger:"hover",placement:"top"});securityToken=$("[name="+t+"]").val();$(document).ajaxSend(function(n,i,r){r.type=="POST"&&typeof securityToken!="undefined"&&(r.contentType.toLowerCase().lastIndexOf("application/json",0)===0?i.setRequestHeader(t,securityToken):r.data&&r.data.indexOf(t)!=-1||(r.data=(r.data&&r.data.length>0?r.data+"&":"")+t+"="+encodeURIComponent(securityToken),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")))});i="";n="input[data-autocomplete-subverse=1]";$(n).blur(function(){var t=$(n).val(),r;t.length>0&&i!=t&&(i=t,r="/ajaxhelpers/autocompletesubversename?exact=true&term="+t,$.ajax({type:"GET",url:r,error:function(n,t,i){var r=getErrorMessage(i)},success:function(n){if(n&&n.length>0){var t=n[0],r=$("#IsAdult"),i=$("#IsAnonymized"),u=$("#AllowAnonymized"),f=$("#AnonDiv");i.prop("disabled",!0);i.prop("readonly",!0);t.allowAnonymized&&u.val(t.allowAnonymized);t.isAdult&&(r.prop("checked")||r.prop("checked",!0));t.isAnonymized==null?(i.prop("disabled",!1),i.prop("readonly",!1),f.show()):t.isAnonymized==!1?i.prop("checked",!1):t.isAnonymized==!0&&i.prop("checked",!0)}}}))});$(n).autocomplete({source:"/ajaxhelpers/autocompletesubversename",minLength:2,select:function(t,i){return $(n).val(i.item.name),!1},focus:function(){return!1}}).autocomplete("instance")._renderItem=function(n,t){return $("<li>").append("<div>"+t.name+"<\/div>").appendTo(n)};$(document).on("click",'a[href="#s"]',function(n){n.preventDefault()});wireTooltips();$(function(){var n=$(window);n.scroll(function(){n.height()+n.scrollTop()==$(document).height()&&$("#loadmorebutton").trigger("click")})});$(function(){if($.connection!=null){var n=$.connection.messagingHub;n!=null&&(n.client.setNotificationsPending=function(n){var t=$('meta[property="og:title"]').attr("content");n>0?($("#mail").hasClass("nohavemail")&&$("#mail").removeClass("nohavemail").addClass("havemail"),$("#mail").prop("title","your have "+n+" unread notifications"),$("#mailcounter").show(),$("#mailcounter").html(n),document.title="("+n+") "+t):($("#mail").hasClass("havemail")&&$("#mail").removeClass("havemail").addClass("nohavemail"),$("#mail").prop("title","no new messages"),$("#mailcounter").html(0),$("#mailcounter").hide(),document.title=t)},n.client.voteChange=function(n,t){var i=0;n==2?(i=$("#ccp").html(),i=parseInt(i)+parseInt(t),$("#ccp").html(i)):(i=$("#scp").html(),i=parseInt(i)+parseInt(t),$("#scp").html(i))},n.client.appendChatMessage=function(n,t,i){$("#subverseChatRoom").append('<div class="chat-message"><div class="chat-message-head"><p><b><a href="/user/'+n+'">'+n+'<\/a><\/b> <span class="chat-message-timestamp">('+i+')<\/span>:<\/p><\/div><div class="chat-message-body">'+t+"<\/div><\/div>");scrollChatToBottom()})}})});submissionVoteLock=null;commentVoteLock=null;$.fn.exists=function(){return this.length!==0};voat={voting:{syncValidationChanges:function(){$("form").removeData("validator");$("form").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse("form")},addOption:function(){var n=$("#Subverse").val();$.ajax({type:"GET",url:"/v/"+n+"/vote/element?type=VoteOption",success:function(n){$('div[data-voat-list="Options"]').append(n);voat.voting.syncValidationChanges()}})},addRestriction:function(){var n=$("#vote-restriction-type").val(),t=$("#Subverse").val();$.ajax({type:"GET",url:"/v/"+t+"/vote/element?type="+n,success:function(n){$('div[data-voat-list="Restrictions"]').append(n);voat.voting.syncValidationChanges()}})},addOutcome:function(n){var t=$(n).closest("[data-voat-item]").find("#vote-outcome-type").val(),i=n,r=$("#Subverse").val();$.ajax({type:"GET",url:"/v/"+r+"/vote/element?type="+t,success:function(n){var t=$(i).closest('div[data-voat-item="Options"]'),r=t.find('div[data-voat-list="Outcomes"]');r.append(n);voat.voting.syncValidationChanges()}})},removeItem:function(n,t){var i=$(n).parents(t);i.remove()},gimmieTheFormMEOW:function(){$("form").submit(function(n){return $(n.currentTarget).valid()&&voat.voting.save(),!1})},save:function(){function o(n){return function(){return $(this).parents("[data-voat-item]").length===n}}function s(n){var t=n.split(".");return t.length>0?t[t.length-1]:n}function f(n,t,i,r){var a,u,h=t?{}:[],c,l,e;if(n===null)return u=$("[data-voat-item]").filter(o(0)),f(u,!0,1);if(a=t?"*[data-voat-list],*[data-voat-field]":"*[data-voat-item]",c=n.find(a).filter(o(i)),t)for(e=0;e<c.length;e++)u=$(c[e]),u.is("[data-voat-field]")?(l=u.val(),(l!=null&&l!=undefined&&l.toString().length>0&&!r||r)&&(h[s(u.attr("name"))]=l)):(h[u.data("voat-list")]={},h[u.data("voat-list")]=f(u,!1,i,r));else for(e=0;e<c.length;e++)h.push(f($(c[e]),!0,i+1,r));return h}for(var i,u,e,n,r=f(null,!0,0,!1),t=0;t<r.Restrictions.length;t++)i=r.Restrictions[t],n={},n.ID=i.ID,n.TypeName=i.TypeName,n.Options=JSON.stringify(i),r.Restrictions[t]=n;for(t=0;t<r.Options.length;t++)for(i=r.Options[t],u=0;u<i.Outcomes.length;u++)e=i.Outcomes[u],n={},n.ID=e.ID,n.TypeName=e.TypeName,n.Options=JSON.stringify(e),i.Outcomes[u]=n;$.ajax({type:"POST",url:"/vote/save",data:JSON.stringify(r),contentType:"application/json",error:function(){alert("error on post")},success:function(n){$("#container").replaceWith(n.data.html);voat.voting.syncValidationChanges();voat.voting.gimmieTheFormMEOW();document.body.scrollTop=document.documentElement.scrollTop=0;n.success&&history.pushState({},"Viewing Vote","../"+n.data.id)}})}}};